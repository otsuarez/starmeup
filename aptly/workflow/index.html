<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

        <title>workflow - Doc</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/prettify-1.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Doc</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">startmeup <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../startmeup/workflow">workflow</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">release <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../release/readme">readme</a>
                        </li>
                    
                        <li >
                            <a href="../../release/alfa">alfa</a>
                        </li>
                    
                        <li >
                            <a href="../../release/make-deploy-stdout">deploy stdout</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">aptly <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li class="active">
                            <a href=".">workflow</a>
                        </li>
                    
                        <li >
                            <a href="../commands">commands</a>
                        </li>
                    
                        <li >
                            <a href="../setup">setup</a>
                        </li>
                    
                        <li >
                            <a href="../gpg-keys">GPG Keys</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">howto <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../howto/vagrant-lxc">vagrant-lxc</a>
                        </li>
                    
                        <li >
                            <a href="../../howto/vagrant-hostmanager">hostmanager</a>
                        </li>
                    
                        <li >
                            <a href="../../howto/apidocs">api doc</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../about">About</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../../release/make-deploy-stdout">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../commands">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#tldr">tl;dr</a></li>
        
    
        <li class="main "><a href="#introduction">Introduction</a></li>
        
    
        <li class="main "><a href="#entities">Entities</a></li>
        
    
        <li class="main "><a href="#workflow">Workflow</a></li>
        
    
        <li class="main "><a href="#using">Using</a></li>
        
            <li><a href="#create-repo-file">Create repo file</a></li>
        
            <li><a href="#add-repo-key">Add repo key</a></li>
        
            <li><a href="#update-the-repo">update the repo</a></li>
        
            <li><a href="#install-packages">install packages</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="tldr">tl;dr</h1>
<p>Aptly is a tool to manage debian repositories (so far). Packages are added to aptly internal package database (called repo), then published via standard repos (Debian repositories i meant). 
Aptly supports local Debian repositories or hosted in Amazon S3.</p>
<h1 id="introduction">Introduction</h1>
<p><a href="http://www.aptly.info/">Aptly</a> is a swiss army knife for Debian repository management: it allows you manage local package repositories and publish them as Debian repository, along with many other features.</p>
<p>There are several packages which handle the creation and maintenance of Debian package repositories. But by design, those tools only allow one version of each package to be available: the latest one.</p>
<p>Aptly can publish more than one version of the same package, a vital feature when it comes to rolling out an specific version or doing a rollback.</p>
<h1 id="entities">Entities</h1>
<p>aptly has several core entities:</p>
<ul>
<li>mirror: mirror of remote repository, consists of metadata, list of packages and package files</li>
<li>local repo: local package repository, consists of metadata, packages and files, packages can be easily added and removed</li>
<li>snapshot: immutable list of packages, basic block to implement repeatability and controlled changes</li>
<li>published repository: published representation of aptly generated snapshot or local repository, ready to be consumed by apt tools</li>
</ul>
<p>We are only using the <code>local repo</code> and <code>publish repository</code> ones.</p>
<h1 id="workflow">Workflow</h1>
<p>Packages are added to a local repo as files, then published as Debian repository (distribution name, prefix) and consumed by apt tools on your Debian systems. All repos are local, the published repositories can be stored locally and accesible via the web server or remotely, on an S3 bucket, and accesed via the <code>apt-s3</code> command.</p>
<p>Once aptly had been installed, first thing to do is to create the repositories. Then create the published repositories. After that packages are added to the local repo and published via updating the published repositories.</p>
<h1 id="using">Using</h1>
<h2 id="create-repo-file">Create repo file</h2>
<p>Create the <code>/etc/apt/sources.list.d/acme.list</code>  file with the following content.</p>
<pre class="prettyprint well"><code>deb http://jenkins.acme.com/apt/prod/ acme-prod acme
deb http://jenkins.acme.com/apt/prod-conf/ acme-prod acme
</code></pre>

<p>Note: Since configuration packages might contain sensitive information (like credentials) a second repository (the <code>-conf</code> one) was created in order to be able to restrict access (via source ip?) while allowing full access to the application code packages.</p>
<p>Replace prod with the actual environment. Also available staging and testing.</p>
<h2 id="add-repo-key">Add repo key</h2>
<p>Add the repo key and update the cache for the repo.</p>
<pre class="prettyprint well"><code>wget  http://jenkins.acme.com/apt/public.key
sudo apt-key add public.key
</code></pre>

<h2 id="update-the-repo">update the repo</h2>
<pre class="prettyprint well"><code>sudo apt-get update -o Dir::Etc::sourcelist=&quot;sources.list.d/acme.list&quot; -o Dir::Etc::sourceparts=&quot;-&quot; -o APT::Get::List-Cleanup=&quot;0&quot;
</code></pre>

<h2 id="install-packages">install packages</h2>
<p>Just use standard <code>apt-get</code> commands to install packages. The <code>apt-cache madison</code> is particularly useful for just print the available versions (allows wildcards) of a package.</p>
<p>For upgrading/installing a package use:</p>
<pre class="prettyprint well"><code>apt-get install &lt;package name&gt;
</code></pre>

<p>Note: There is no apt-get upgrade command on Debian, that role is accomplished via the install option.</p>
<p>For installing an specific version use:</p>
<pre class="prettyprint well"><code>apt-get install &lt;package name&gt;=&lt;package version&gt;
</code></pre>

</div>
        </div>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/prettify-1.0.min.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>